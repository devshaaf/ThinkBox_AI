{% extends 'base/base.html' %}

{% block content %}
<div class="flex flex-col h-full relative">
    
    <div class="md:hidden flex items-center justify-between p-4 bg-aurora-800 border-b border-aurora-700">
        <button class="text-white"><i class="ri-menu-line text-xl"></i></button>
        <span class="font-bold text-white">ThinkBox AI</span>
        <div class="w-6"></div>
    </div>

    <div id="chat-container" class="flex-1 overflow-y-auto p-4 md:p-8 scroll-smooth">
        <div class="max-w-3xl mx-auto space-y-6">
            
            {% if not messages %}
            <div class="text-center py-20">
                <div class="w-16 h-16 bg-aurora-800 rounded-2xl mx-auto flex items-center justify-center mb-6 shadow-lg shadow-emerald-500/20">
                    <i class="ri-bard-fill text-3xl text-aurora-400"></i>
                </div>
                <h2 class="text-2xl font-bold text-white mb-2">How can I help you today?</h2>
                <p class="text-slate-400">Ask me anything about your documents in <span class="text-aurora-400">{{ active_workspace.name }}</span>.</p>
            </div>
            {% endif %}

            {% for msg in messages %}
                {% if msg.role == 'USER' %}
                <div class="flex justify-end">
                    <div class="bg-aurora-700 text-white px-5 py-3 rounded-2xl rounded-tr-sm max-w-[85%] leading-relaxed shadow-md">
                        {{ msg.message }}
                    </div>
                </div>
                {% else %}
                <div class="flex gap-4">
                    <div class="w-8 h-8 rounded-full bg-gradient-to-br from-aurora-500 to-emerald-400 flex-shrink-0 flex items-center justify-center shadow-lg">
                        <i class="ri-sparkling-fill text-white text-xs"></i>
                    </div>
                    <div class="flex-1 space-y-2">
                        <div class="text-slate-300 leading-relaxed prose prose-invert max-w-none">
                            {{ msg.message|linebreaks }}
                        </div>
                        
                        {% if msg.retrieved_chunks %}
                        <div class="mt-2">
                            <details class="group">
                                <summary class="list-none cursor-pointer text-xs text-slate-500 hover:text-aurora-400 flex items-center gap-1 transition-colors">
                                    <i class="ri-book-open-line"></i> View Sources
                                </summary>
                                <div class="mt-2 bg-aurora-800/60 p-3 rounded border border-aurora-700/60 text-xs text-slate-300">
                                    Source content snippets here...
                                </div>
                            </details>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            {% endfor %}
            
            <div id="scroll-bottom"></div>
        </div>
    </div>

    <div class="p-4 bg-aurora-900/95 backdrop-blur-sm border-t border-aurora-700/60">
        <div class="max-w-3xl mx-auto">
            <form method="POST" class="relative">
                {% csrf_token %}
                <div class="relative bg-aurora-800 rounded-2xl border border-aurora-700 focus-within:border-aurora-500 focus-within:ring-1 focus-within:ring-aurora-500 transition-all shadow-lg">
                    <textarea 
                        name="message" 
                        rows="1" 
                        placeholder="Message Nexus AI..." 
                        class="w-full bg-transparent text-white placeholder-slate-500 px-4 py-4 pr-12 rounded-2xl focus:outline-none resize-none max-h-48"
                        oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px'"
                    ></textarea>
                    
                    <button type="submit" class="absolute bottom-2 right-2 p-2 bg-gradient-brand hover:brightness-110 text-white rounded-xl transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="ri-arrow-up-line"></i>
                    </button>
                </div>
                <p class="text-center text-[10px] text-slate-600 mt-2">
                    AI can make mistakes. Please review generated information.
                </p>
            </form>
        </div>
    </div>
</div>
{% endblock %}